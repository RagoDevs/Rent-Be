// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.25.0
// source: admin.sql

package db

import (
	"context"
	"time"

	"github.com/google/uuid"
)

const createAdmin = `-- name: CreateAdmin :one
INSERT INTO admin (phone, password_hash, activated)
VALUES ($1, $2, $3 )
RETURNING id, created_at, version
`

type CreateAdminParams struct {
	Phone        string `json:"phone"`
	PasswordHash []byte `json:"password_hash"`
	Activated    bool   `json:"activated"`
}

type CreateAdminRow struct {
	ID        uuid.UUID `json:"id"`
	CreatedAt time.Time `json:"created_at"`
	Version   uuid.UUID `json:"version"`
}

func (q *Queries) CreateAdmin(ctx context.Context, arg CreateAdminParams) (CreateAdminRow, error) {
	row := q.db.QueryRowContext(ctx, createAdmin, arg.Phone, arg.PasswordHash, arg.Activated)
	var i CreateAdminRow
	err := row.Scan(&i.ID, &i.CreatedAt, &i.Version)
	return i, err
}

const getAdminByPhone = `-- name: GetAdminByPhone :one
SELECT id, created_at, phone, password_hash, activated, version
FROM admin
WHERE phone = $1
`

func (q *Queries) GetAdminByPhone(ctx context.Context, phone string) (Admin, error) {
	row := q.db.QueryRowContext(ctx, getAdminByPhone, phone)
	var i Admin
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.Phone,
		&i.PasswordHash,
		&i.Activated,
		&i.Version,
	)
	return i, err
}

const getHashTokenForAdmin = `-- name: GetHashTokenForAdmin :one
SELECT admin.id, admin.created_at,admin.phone, admin.password_hash,admin.version, admin.activated
FROM admin
INNER JOIN token
ON admin.id = token.id
WHERE token.hash = $1
AND token.scope = $2
AND token.expiry > $3
`

type GetHashTokenForAdminParams struct {
	Hash   []byte    `json:"hash"`
	Scope  string    `json:"scope"`
	Expiry time.Time `json:"expiry"`
}

type GetHashTokenForAdminRow struct {
	ID           uuid.UUID `json:"id"`
	CreatedAt    time.Time `json:"created_at"`
	Phone        string    `json:"phone"`
	PasswordHash []byte    `json:"password_hash"`
	Version      uuid.UUID `json:"version"`
	Activated    bool      `json:"activated"`
}

func (q *Queries) GetHashTokenForAdmin(ctx context.Context, arg GetHashTokenForAdminParams) (GetHashTokenForAdminRow, error) {
	row := q.db.QueryRowContext(ctx, getHashTokenForAdmin, arg.Hash, arg.Scope, arg.Expiry)
	var i GetHashTokenForAdminRow
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.Phone,
		&i.PasswordHash,
		&i.Version,
		&i.Activated,
	)
	return i, err
}

const updateAdmin = `-- name: UpdateAdmin :one
UPDATE admin
SET phone = $1, password_hash = $2, activated = $3, version = uuid_generate_v4()
WHERE id = $4 AND version = $5
RETURNING version
`

type UpdateAdminParams struct {
	Phone        string    `json:"phone"`
	PasswordHash []byte    `json:"password_hash"`
	Activated    bool      `json:"activated"`
	ID           uuid.UUID `json:"id"`
	Version      uuid.UUID `json:"version"`
}

func (q *Queries) UpdateAdmin(ctx context.Context, arg UpdateAdminParams) (uuid.UUID, error) {
	row := q.db.QueryRowContext(ctx, updateAdmin,
		arg.Phone,
		arg.PasswordHash,
		arg.Activated,
		arg.ID,
		arg.Version,
	)
	var version uuid.UUID
	err := row.Scan(&version)
	return version, err
}
